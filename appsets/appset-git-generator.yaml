applicationset:
  apiVersion: argoproj.io/v1alpha1
  kind: ApplicationSet
  metadata:
    name: name-appset
  spec:
    generators:
      - git:
          files:
            - path: "helm2/app1/*/*/config.json"
          repoURL: "https://github.com/mteodor/argocd-example-apps"
          revision: master
    goTemplate: true
    goTemplateOptions:
      - missingkey=error
    template:
      metadata:
        name: "{{.path.basename}}"
      spec:
        destination:
          name: "{{.cluster.name}}"
          namespace: "{{.path.basename}}"
        project: 2de16080
        sources:
          - ref: test
            repoURL: "https://github.com/mteodor/argocd-example-apps"
            targetRevision: syncstep-multisource
          - chart: nginx
            helm:
              valueFiles:
                - "$test/{{.path.path}}/values.yaml"
            repoURL: "https://charts.bitnami.com/bitnami"
            targetRevision: 18.1.2
        syncPolicy:
          automated: {}
          syncOptions:
            - Validate=true
            - CreateNamespace=true
